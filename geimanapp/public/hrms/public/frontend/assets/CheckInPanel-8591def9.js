import{i as b,a as x,Q as H,R as P,c as $,b as q,S as A,e as D,f as r,j as d,n as a,t as n,q as o,F as E,k as w,l as u,U as C,v as G,x as R,z as Q,a5 as S}from"./frappe-ui-02049d65.js";import{c as J,m as K}from"./index-1b959967.js";import{a as W}from"./formatters-c2abf875.js";const X={class:"flex flex-col bg-white rounded w-full py-6 px-4 border-none"},Z={class:"text-lg font-bold text-gray-900"},ee={key:0,class:"font-medium text-sm text-gray-500 mt-1.5"},te=["onClick"],oe={key:1,class:"font-medium text-sm text-gray-500 mt-1.5"},ae={class:"h-120 w-full flex flex-col items-center justify-center gap-5 p-4 mb-5"},se={class:"flex flex-col gap-1.5 mt-2 items-center justify-center"},ne={class:"font-bold text-xl"},le={class:"font-medium text-gray-500 text-sm"},ie={key:0,class:"font-medium text-gray-500 text-sm"},ce={class:"rounded border-4 translate-z-0 block overflow-hidden w-full h-170"},re=["src"],Y="Employee Checkin",fe={__name:"CheckInPanel",setup(de){const m=b("$socket"),M=b("$employee"),_=b("$dayjs"),t=b("$translate"),N=x(null),p=x(0),f=x(0),l=x(""),g=H({url:"hrms.api.get_hr_settings",auto:!0}),i=P({doctype:Y,fields:["name","employee","employee_name","log_type","time","device_id"],filters:{employee:M.data.name},orderBy:"time desc"});i.reload();const s=$(()=>i.list.loading||!i.data?{}:i.data[0]),V=$(()=>{var e;return((e=s==null?void 0:s.value)==null?void 0:e.log_type)==="IN"?"check-in":"check-out"}),h=$(()=>{var e;return((e=s==null?void 0:s.value)==null?void 0:e.log_type)==="IN"?{action:"OUT",label:t("Check Out")}:{action:"IN",label:t("Check In")}});function T(e){p.value=e.coords.latitude,f.value=e.coords.longitude,l.value=[t("Latitude: {0}Â°",[Number(p.value).toFixed(5)]),t("Longitude: {0}Â°",[Number(f.value).toFixed(5)])].join(", ")}function F(e){l.value="Unable to retrieve your location",e&&(l.value+=`: ERROR(${e.code}): ${e.message}`)}const O=()=>{navigator.geolocation?(l.value=t("Locating..."),navigator.geolocation.getCurrentPosition(T,F)):l.value=t("Geolocation is not supported by your current browser")},U=()=>{var e;N.value=_().format("YYYY-MM-DD HH:mm:ss"),(e=g.data)!=null&&e.allow_geolocation_tracking&&O()},z=e=>{const c=t(e==="IN"?"Check-in":"Check-out");i.insert.submit({employee:M.data.name,log_type:e,time:N.value,latitude:p.value,longitude:f.value},{onSuccess(){K.dismiss(),S({title:t("Success"),text:t("{0} successful!",[c]),icon:"check-circle",position:"bottom-center",iconClasses:"text-green-500"})},onError(L){let y=L.messages||[];for(const v of y)S({title:t("Error"),text:v||t("{0} failed!",[c]),icon:"alert-circle",position:"bottom-center",iconClasses:"text-red-500"})}})};return q(()=>{m.emit("doctype_subscribe",Y),m.on("list_update",e=>{e.doctype==Y&&i.reload()})}),A(()=>{m.emit("doctype_unsubscribe",Y),m.off("list_update")}),(e,c)=>{var v,B,I,j;const L=D("router-link"),y=D("Button");return r(),d(E,null,[a("div",X,[a("h2",Z,n(o(t)("Hey, {0} ðŸ‘‹",[(B=(v=o(M))==null?void 0:v.data)==null?void 0:B.first_name])),1),(I=o(g).data)!=null&&I.allow_employee_checkin_from_mobile_app?(r(),d(E,{key:0},[s.value?(r(),d("div",ee,[a("span",null,n(o(t)("Last {0} was at {1}",[o(t)(V.value),o(W)(s.value.time)])),1),c[1]||(c[1]=a("span",{class:"whitespace-pre"}," Â· ",-1)),w(L,{to:{name:"EmployeeCheckinListView"}},{default:u(({navigate:k})=>[a("span",{onClick:k,class:"underline"},"View List",8,te)]),_:1})])):C("",!0),w(y,{class:"mt-4 mb-1 drop-shadow-sm py-5 text-base",id:"open-checkin-modal",onClick:U},{prefix:u(()=>[w(o(G),{name:h.value.action==="IN"?"arrow-right-circle":"arrow-left-circle",class:"w-4"},null,8,["name"])]),default:u(()=>[R(" "+n(h.value.label),1)]),_:1})],64)):(r(),d("div",oe,n(o(_)().format("ddd, D MMMM, YYYY")),1))]),(j=o(g).data)!=null&&j.allow_employee_checkin_from_mobile_app?(r(),Q(o(J),{key:0,ref:"modal",trigger:"open-checkin-modal","initial-breakpoint":1,breakpoints:[0,1]},{default:u(()=>{var k;return[a("div",ae,[a("div",se,[a("div",ne,n(o(_)(N.value).format("hh:mm:ss a")),1),a("div",le,n(o(_)().format("D MMM, YYYY")),1)]),(k=o(g).data)!=null&&k.allow_geolocation_tracking?(r(),d(E,{key:0},[l.value?(r(),d("span",ie,n(l.value),1)):C("",!0),a("div",ce,[a("iframe",{width:"100%",height:"170",frameborder:"0",scrolling:"no",marginheight:"0",marginwidth:"0",style:{border:"0"},src:`https://maps.google.com/maps?q=${p.value},${f.value}&hl=en&z=15&output=embed`},null,8,re)])],64)):C("",!0),w(y,{loading:o(i).insert.loading,variant:"solid",class:"w-full py-5 text-sm disabled:bg-gray-700",onClick:c[0]||(c[0]=ue=>z(h.value.action))},{default:u(()=>[R(n(o(t)("Confirm {0}",[h.value.label])),1)]),_:1},8,["loading"])])]}),_:1},512)):C("",!0)],64)}}};export{fe as default};
//# sourceMappingURL=CheckInPanel-8591def9.js.map
