var fe=Object.defineProperty,pe=Object.defineProperties;var ve=Object.getOwnPropertyDescriptors;var J=Object.getOwnPropertySymbols;var ye=Object.prototype.hasOwnProperty,ge=Object.prototype.propertyIsEnumerable;var K=(a,l,t)=>l in a?fe(a,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[l]=t,W=(a,l)=>{for(var t in l||(l={}))ye.call(l,t)&&K(a,t,l[t]);if(J)for(var t of J(l))ge.call(l,t)&&K(a,t,l[t]);return a},Q=(a,l)=>pe(a,ve(l));var I=(a,l,t)=>new Promise((B,F)=>{var D=u=>{try{R(t.next(u))}catch(c){F(c)}},L=u=>{try{R(t.throw(u))}catch(c){F(c)}},R=u=>u.done?B(u.value):Promise.resolve(u.value).then(D,L);R((t=t.apply(a,l)).next())});import{i as T,O as h,a1 as _e,X as we,a as y,c as A,Q as X,w as he,b as ke,e as P,f as i,j as S,k as r,l as f,n as k,q as s,v as Y,t as G,I as be,z as x,x as Ce,U as N,F as Z,H as xe,J as ee,a4 as Fe,ad as Re}from"./frappe-ui-02049d65.js";import{h as $e,H as Se,J as Be,I as Ee,c as qe,m as te}from"./index-1b959967.js";import Ve from"./TabButtons-2d61a943.js";import Ie from"./EmployeeCheckinItem-2e9e28fe.js";import Te from"./AttendanceRequestItem-78e3d3ff.js";import Ae from"./ShiftRequestItem-3d1d2b10.js";import Ne from"./ShiftAssignmentItem-43cca346.js";import De from"./LeaveRequestItem-1f5fc8cd.js";import Le from"./ExpenseClaimItem-9e9315fa.js";import je from"./EmployeeAdvanceItem-6824eccb.js";import He from"./ListFiltersActionSheet-b4601211.js";import Me from"./CustomIonModal-599f147f.js";import{R as Oe,b as Pe}from"./requestSummaryFields-7e2c6adb.js";import{u as Ue}from"./workflow-0b2a2f3b.js";import{u as ze}from"./realtime-14e47ccc.js";import"./ListItem-3fa63396.js";import"./EmployeeAvatar-6acab2d7.js";import"./employee-399cdb46.js";import"./attendance-496ae3d9.js";import"./formatters-c2abf875.js";import"./ShiftIcon-e9518345.js";import"./leaves-750319ca.js";import"./user-9e8700ad.js";import"./EmployeeAdvanceIcon-d86105a7.js";import"./FormField-1058c29b.js";import"./Link-cfd1cc27.js";import"./FormattedField-abf651f5.js";const Je={class:"w-full sm:w-96"},Ke={class:"flex flex-row bg-white shadow-sm py-4 px-3 items-center justify-between border-b"},We={class:"flex flex-row items-center"},Qe={class:"text-xl font-semibold text-gray-900"},Xe={class:"flex flex-row gap-2"},Ye={class:"w-full"},Ge={key:1,class:"flex flex-col bg-white rounded mt-5"},Ze={key:3,class:"flex mt-2 items-center justify-center"},St={__name:"ListView",props:{doctype:{type:String,required:!0},fields:{type:Array,required:!0},groupBy:{type:String,required:!1},filterConfig:{type:Array,required:!0},tabButtons:{type:Array,required:!1},pageTitle:{type:String,required:!0}},setup(a){const l=T("$translate"),t=a,B=e=>{var o;return(o=e==null?void 0:e.key)!=null?o:e},F={"Employee Checkin":h(Ie),"Attendance Request":h(Te),"Shift Request":h(Ae),"Shift Assignment":h(Ne),"Leave Application":h(De),"Expense Claim":h(Le),"Employee Advance":h(je)},D=_e(),L=T("$dayjs"),R=T("$socket"),u=T("$employee"),c=we({}),E=y(t.tabButtons?B(t.tabButtons[0]):void 0),j=y(!1),b=y([]),$=y(null),H=y(!1),p=y(null),U=y(null),M=y(!0),q=y({doctype:t.doctype,fields:t.fields,group_by:t.groupBy,order_by:`\`tab${t.doctype}\`.modified desc`,page_length:50}),O=A(()=>t.tabButtons&&E.value===B(t.tabButtons[1])),oe=A(()=>`${t.doctype.replace(/\s+/g,"")}FormView`),se=A(()=>`${t.doctype.replace(/\s+/g,"")}DetailView`),ae=A(()=>{const e=[];return O.value?e.push([t.doctype,"employee","!=",u.data.name]):e.push([t.doctype,"employee","=",u.data.name]),e}),d=X({url:"frappe.desk.reportview.get",onSuccess:e=>{var o;((o=e.values)==null?void 0:o.length)<q.value.page_length&&(M.value=!1)},transform(e){if(e.length===0)return[];const o=e.keys,C=e.values.map(v=>{const g={};return o.forEach((n,V)=>{g[n]=v[V]}),g});let w;return!d.params.start||d.params.start===0?w=C:w=d.data.concat(C),w}}),le=X({url:"frappe.client.has_permission",params:{doctype:t.doctype,docname:null,perm_type:"create"},auto:!0}),ne=e=>I(this,null,function*(){p.value=e,p.value.doctype="Employee Checkin",p.value.date=e.time,p.value.formatted_time=L(e.time).format("HH:mm a"),p.value.formatted_latitude=`${Number(e.latitude).toFixed(5)}°`,p.value.formatted_longitude=`${Number(e.longitude).toFixed(5)}°`,H.value=!0}),re=()=>I(this,null,function*(){H.value=!1,p.value=null});function z(){t.filterConfig.forEach(e=>{c[e.fieldname]={condition:"=",value:null}}),b.value=[]}z();function ie(){let e="",o="";b.value=[];for(const m in c)e=c[m].condition,typeof e=="object"&&e!==null&&(e=e.value),o=c[m].value,e&&o&&b.value.push([t.doctype,m,e,o])}function ue(){ie(),_(),te.dismiss(),j.value=!!b.value.length}function ce(){z(),_(),te.dismiss(),j.value=!1}function _(e=0){e===0&&(M.value=!0);const o=[[t.doctype,"docstatus","!=","2"]];o.push(...ae.value),b.value&&o.push(...b.value),$.value&&q.value.fields.push($.value),d.submit(Q(W({},q.value),{start:e||0,filters:o}))}const de=Re(()=>{if(!M.value)return;const{scrollTop:e,scrollHeight:o,clientHeight:m}=U.value;if(e/(o-m)*100>=90){const w=d.params.start+q.value.page_length;_(w)}},500),me=e=>{setTimeout(()=>{_(),e.target.complete()},500)};return he(()=>E.value,e=>{_()}),ke(()=>I(this,null,function*(){const e=Ue(t.doctype);yield e.workflowDoc.promise,$.value=e.getWorkflowStateField(),_(),ze(R,t.doctype,()=>_())})),(e,o)=>{const m=P("Button"),C=P("router-link"),w=P("EmptyState");return i(),S(Z,null,[r(s($e),{class:"ion-no-border"},{default:f(()=>{var v,g;return[k("div",Je,[k("div",Ke,[k("div",We,[r(m,{variant:"ghost",class:"!px-1 mr-1 hover:bg-white",onClick:o[0]||(o[0]=n=>s(D).back())},{default:f(()=>[r(s(Y),{name:"chevron-left",class:"h-5 w-5"})]),_:1}),k("h2",Qe,G(a.pageTitle),1)]),k("div",Xe,[r(m,{id:"show-filter-modal",icon:"filter",variant:"subtle",class:be([j.value?"!border !border-gray-800 !bg-white !text-gray-900 !font-semibold":""])},null,8,["class"]),(g=(v=s(le))==null?void 0:v.data)!=null&&g.has_permission&&t.doctype!="Employee Checkin"?(i(),x(C,{key:0,to:{name:oe.value}},{default:f(({navigate:n})=>[r(m,{variant:"solid",class:"mr-2",onClick:n},{prefix:f(()=>[r(s(Y),{name:"plus",class:"w-4"})]),default:f(()=>[Ce(" "+G(s(l)("New",null,t.doctype)),1)]),_:2},1032,["onClick"])]),_:1},8,["to"])):N("",!0)])])])]}),_:1}),r(s(Ee),null,{default:f(()=>{var v,g;return[r(s(Se),{slot:"fixed",onIonRefresh:o[1]||(o[1]=n=>me(n))},{default:f(()=>[r(s(Be))]),_:1}),k("div",{class:"flex flex-col items-center mb-7 p-4 h-full w-full sm:w-96 overflow-y-auto",ref_key:"scrollContainer",ref:U,onScroll:o[3]||(o[3]=()=>s(de)())},[k("div",Ye,[t.tabButtons?(i(),x(Ve,{key:0,class:"mt-5",buttons:t.tabButtons,modelValue:E.value,"onUpdate:modelValue":o[2]||(o[2]=n=>E.value=n)},null,8,["buttons","modelValue"])):N("",!0),!s(d).loading&&((v=s(d).data)!=null&&v.length)?(i(),S("div",Ge,[(i(!0),S(Z,null,xe(s(d).data,n=>(i(),S("div",{class:"p-3.5 items-center justify-between border-b cursor-pointer",key:n.name},[t.doctype==="Employee Checkin"?(i(),x(ee(F[a.doctype]),{key:0,doc:n,isTeamRequest:O.value,workflowStateField:$.value,onClick:V=>ne(n)},null,8,["doc","isTeamRequest","workflowStateField","onClick"])):(i(),x(C,{key:1,to:{name:se.value,params:{id:n.name}}},{default:f(({navigate:V})=>[(i(),x(ee(F[a.doctype]),{doc:n,isTeamRequest:O.value,workflowStateField:$.value,onClick:V},null,8,["doc","isTeamRequest","workflowStateField","onClick"]))]),_:2},1032,["to"]))]))),128))])):s(d).loading?N("",!0):(i(),x(w,{key:2,message:s(l)("No {0} found",[(g=t.doctype)==null?void 0:g.toLowerCase()])},null,8,["message"])),s(d).loading?(i(),S("div",Ze,[r(s(Fe),{class:"w-8 h-8 text-gray-800"})])):N("",!0)])],544),r(Me,{trigger:"show-filter-modal"},{actionSheet:f(()=>[r(He,{filterConfig:a.filterConfig,onApplyFilters:ue,onClearFilters:ce,filters:c,"onUpdate:filters":o[4]||(o[4]=n=>c=n)},null,8,["filterConfig","filters"])]),_:1})]}),_:1}),r(s(qe),{ref:"modal","is-open":H.value,onDidDismiss:re,"initial-breakpoint":1,breakpoints:[0,1]},{default:f(()=>[r(Oe,{fields:s(Pe),showOpenForm:!1,modelValue:p.value,"onUpdate:modelValue":o[5]||(o[5]=v=>p.value=v)},null,8,["fields","modelValue"])]),_:1},8,["is-open"])],64)}}};export{St as default};
//# sourceMappingURL=ListView-5e52b8c5.js.map
